---
name: 1. 了解核心
route: /core/index
menu: 2. Core核心
---

import { Playground } from 'docz'
import react from 'react';
import { Input, Radio } from 'nowrapper/lib/antd';
import Form, { FormItem, FormCore } from 'noform';
import 'antd/dist/antd.css';
import 'noform/dist/index.css';
import 'nowrapper/dist/antd/index.css';


# 了解核心

## Core是什么？

** Core是表单的抽象概念，它包含了表单的所有数据。**

在NoForm的定义中，表单数据分为 [**值(values)**](/form/core/value)，[**状态(status)**](/form/core/index#获取修改错误信息error)，[**错误(errors)**](/form/core/errors)， [**属性(props)**](/form/core/props)， 同时它提供了一系列的API去控制这些数据。

因此表单就变成两部分，**View 视图层** 和 **Core 数据层**，View视图层对逻辑无感知，仅仅单纯显示 Core 的数据。 因此通过对Core的操作就能完成视图的变更。

<img width="600px" src="https://img.alicdn.com/tfs/TB1mz_malCw3KVjSZR0XXbcUpXa-1344-664.png" alt="core-form示意图" />

## 如何使用

引入方式

```jsx
import Form, { FormCore } from 'noform';
```

定义表单之前需要先定义核心，初始话核心有以下两种方式：

1. 外部传入： 通过 `new FormCore()` 构建新的表单核心 【推荐】
```jsx
const core = new FormCore();
return <Form core={core}>
    ...
</Form>
```

2. 内置生成: 通过 `onMount`获取内置构建的核心
```jsx
const onMount = (core) => {}
return <Form onMount={onMount}>
    ...
</Form>
```


2. 设置方法
```jsx
const core = new FormCore();
core.onChange = (fireKeys, values, ctx) => {
    // 同上所述
}
```

## 构建参数

```jsx
const core = new FormCore({ // 参数列表
    ...params
})
```

| 参数名 | 作用 | 类型 | 默认值 |
| ------ | ------ | ------ | ----- |
| values | 初始值集合 | 对象 | {} |
| status | 初始状态集合 | 对象 | {} |
| errors | 初始错误信息集合 | 对象 | {} |
| props | 初始props集合 | 对象 | {} |
| globalStatus | 初始全局状态 | ENUM ['edit', 'preview', 'disabled'] | 'edit' |
| validateConfig | 校验规则 | 参考[校验](/form/core/validate)一节， 规则与[async-validator](https://github.com/yiminghe/async-validator)一致 | {} |
| onChange | 监听值变更 | 方法(firekeys, values, core) | noop |
| onBlur | 监听焦点变更 | 方法(key) | noop |
| onFocus | 监听焦点变更 | 方法(key) | noop |
| onEvent | 监听以上三种事件 | 方法(paylaod: { fireKey, fn, args }) | noop |
| interceptor | 拦截器 | 参考[拦截器](/form/core/interceptor)一节 | {} |

## API

## 监听变更

核心监听有以下两种方式：

1. 构建函数传入【推荐】
```jsx
const core = new FormCore({
    onChange: (fireKeys, values, ctx) => {
        // fireKeys 是此次发生变更字段，数组类型
        // values 是发生变化后的所有表单的值集合
        // ctx 是核心实例
    }
});
```

## 获取/修改值(values)

```jsx
core.getValues(); // 获取整体表单的值
core.getItemValue('username'); // 获取单字段值
core.setValues({ username: 'bobby' }); // 设置整体表单的值
core.setItemValue('username', 'bobby'); // 设置单字段的值
```

## 获取/修改状态(status)

```jsx
core.getStatus(); // 获取整体表单的状态
core.getItemStatus('username'); // 获取单字段状态
core.setStatus({ username: 'preview' }); // 设置整体表单的状态
core.setItemStatus('username', 'disabled'); // 设置单字段的状态
core.getGlobalStatus(); // 获取全局状态
core.setGlobalStatus('edit'); // 设置全局状态
```

## 获取/修改属性信息(props)

**FormItem** 属性保留字为： `label`, `prefix`, `suffix`, `help`, `hint`, `top`, `required`。

当设置这些值的时候，会影响 **FormItem**, 除此之外会影响真实的表单组件。

```jsx
core.getItemProps('username');
core.setItemProps('username', {
    dataSource: [
        { label: 'bobby', value: 'bobby'},
        { label: 'leslie', value: 'leslie'}
    ]
});
```

> `setProps` 常见场景是替换类似 **Select** 组件的`dataSource`，并且不会像`setState`引起全局的渲染。

> `NoForm` 的治理思想是 state 和 core 不混用，表单页面仅仅使用core来控制，避免不必要的渲染。


## 获取/修改错误信息(error)

错误信息的默认值和空值为null

```jsx
core.getError(); // 获取整体表单的错误信息
core.getItemError('username'); // 获取单字段错误信息
core.setError({ username: 'username is required' }); // 设置整体表单的错误信息
core.setItemError('username', 'username is required'); // 设置单字段的错误信息
```

注：`setError` 是实现校验的底层的方法，校验会自动调用，开发者尽可能不需要使用它，除非知道自己在做什么。
